// Translations for Lucky Draw Application
const translations = {
    vi: {
        // Header
        appTitle: 'QUAY LÃ€ TRÃšNG',
        
        // Prize levels
        prizeSpecial: 'GIáº¢I Äáº¶C BIá»†T',
        prizeFirst: 'GIáº¢I NHáº¤T',
        prizeSecond: 'GIáº¢I NHÃŒ',
        prizeThird: 'GIáº¢I BA',
        prizeConsolation: 'GIáº¢I KHUYáº¾N KHÃCH',
        
        // Display area
        instruction: 'Nháº¥n nÃºt Quay sá»‘ Ä‘á»ƒ báº¯t Ä‘áº§u',
        
        // Buttons
        btnDraw: 'QUAY Sá»',
        btnDrawing: 'ÄANG QUAY...',
        btnLoad: 'Táº£i danh sÃ¡ch',
        btnRegister: 'ÄÄ‚NG KÃ',
        
        // Winners section
        winnersTitle: 'Danh sÃ¡ch trÃºng thÆ°á»Ÿng',
        winnerNumber: 'MÃ£ sá»‘',
        winnerName: 'TÃªn',
        winnerPrize: 'Giáº£i thÆ°á»Ÿng',
        
        // Participants section
        participantsTitle: 'Quáº£n lÃ½ danh sÃ¡ch tham gia',
        participantsPlaceholder: `Nháº­p danh sÃ¡ch tham gia (má»—i dÃ²ng má»™t ngÆ°á»i):
MÃ£ - TÃªn

VÃ­ dá»¥:
VNPT000001 - Nguyá»…n VÄƒn A
CTV000001 - Tráº§n Thá»‹ B
VNPT000002 - LÃª VÄƒn C
...

Hoáº·c chá»‰ nháº­p mÃ£:
VNPT000001
CTV000001
VNPT000002`,
        totalParticipants: 'Tá»•ng sá»‘ tham gia:',
        remainingParticipants: 'CÃ²n láº¡i:',
        
        // Alerts
        alertNoInput: 'Vui lÃ²ng nháº­p danh sÃ¡ch sá»‘ tham gia!',
        alertInvalidList: 'Danh sÃ¡ch khÃ´ng há»£p lá»‡!',
        alertLoadSuccess: 'ÄÃ£ táº£i {count} sá»‘ tham gia thÃ nh cÃ´ng!',
        alertNoRemaining: 'KhÃ´ng cÃ²n sá»‘ tham gia nÃ o! Vui lÃ²ng táº£i láº¡i danh sÃ¡ch.',
        
        // Congratulations popup
        congratulations: 'CHÃšC Má»ªNG!',
        winnerPosition: 'NgÆ°á»i thá»©',
        totalWinners: 'Tá»•ng sá»‘ ngÆ°á»i trÃºng',
        people: 'ngÆ°á»i',
        winnerCode: 'MÃ£ sá»‘:',
        winnerNameLabel: 'TÃªn:',
        prizeLabel: 'Giáº£i thÆ°á»Ÿng:',
        btnClose: 'ÄÃ³ng',
        
        // Footer
        footerText: 'Â© 2026 Lucky Draw. All rights reserved.',
        
        // Default participant name
        defaultParticipant: 'NgÆ°á»i tham gia',
        
        // Prize names (lowercase for data)
        prizeSpecialData: 'giáº£i Ä‘áº·c biá»‡t',
        prizeFirstData: 'giáº£i nháº¥t',
        prizeSecondData: 'giáº£i nhÃ¬',
        prizeThirdData: 'giáº£i ba',
        prizeConsolationData: 'giáº£i khuyáº¿n khÃ­ch',
        
        // Settings section
        settingsTitle: 'Cáº¥u hÃ¬nh há»‡ thá»‘ng',
        timingSettings: 'CÃ i Ä‘áº·t thá»i gian',
        prizeSettings: 'Danh sÃ¡ch giáº£i thÆ°á»Ÿng',
        prizeCountSettings: 'Sá»‘ lÆ°á»£ng káº¿t quáº£',
        spinDuration: 'Thá»i gian quay sá»‘ (giÃ¢y):',
        digitDelay: 'Thá»i gian hiá»‡n tá»«ng sá»‘ (giÃ¢y):',
        spinDurationHint: 'Thá»i gian chá» trÆ°á»›c khi hiá»ƒn thá»‹ káº¿t quáº£',
        digitDelayHint: 'Khoáº£ng cÃ¡ch thá»i gian giá»¯a cÃ¡c sá»‘ káº¿t quáº£',
        countSpecialLabel: 'Giáº£i Ä‘áº·c biá»‡t:',
        countFirstLabel: 'Giáº£i nháº¥t:',
        countSecondLabel: 'Giáº£i nhÃ¬:',
        countThirdLabel: 'Giáº£i ba:',
        countConsolationLabel: 'Giáº£i khuyáº¿n khÃ­ch:',
        countHint: 'Sá»‘ lÆ°á»£ng ngÆ°á»i trÃºng',
        prizeSpecialLabel: 'Giáº£i Ä‘áº·c biá»‡t:',
        prizeFirstLabel: 'Giáº£i nháº¥t:',
        prizeSecondLabel: 'Giáº£i nhÃ¬:',
        prizeThirdLabel: 'Giáº£i ba:',
        prizeConsolationLabel: 'Giáº£i khuyáº¿n khÃ­ch:',
        prizePlaceholder: 'Nháº­p tÃªn giáº£i thÆ°á»Ÿng',
        btnSaveSettings: 'LÆ°u cáº¥u hÃ¬nh',
        btnResetSettings: 'KhÃ´i phá»¥c máº·c Ä‘á»‹nh',
        alertSettingsSaved: 'ÄÃ£ lÆ°u cáº¥u hÃ¬nh thÃ nh cÃ´ng!',
        alertSettingsReset: 'ÄÃ£ khÃ´i phá»¥c cáº¥u hÃ¬nh máº·c Ä‘á»‹nh!',
        
        // Background customization
        bgCustomization: 'TÃ¹y chá»‰nh hÃ¬nh ná»n',
        bgCustomLabel: 'HÃ¬nh ná»n tÃ¹y chá»‰nh:',
        btnUploadBg: 'ðŸ“ Táº£i lÃªn hÃ¬nh ná»n',
        bgHint: 'Táº£i lÃªn hÃ¬nh áº£nh ná»n cá»§a báº¡n (JPG, PNG)',
        btnResetBg: 'ðŸ”„ KhÃ´i phá»¥c máº·c Ä‘á»‹nh',
        bgNoCustom: 'ChÆ°a cÃ³ hÃ¬nh ná»n tÃ¹y chá»‰nh',
        bgCurrentBg: 'HÃ¬nh ná»n hiá»‡n táº¡i',
        bgUploadSuccess: 'âœ… ÄÃ£ táº£i lÃªn hÃ¬nh ná»n!',
        bgResetSuccess: 'âœ… ÄÃ£ khÃ´i phá»¥c hÃ¬nh ná»n máº·c Ä‘á»‹nh'
    },
    en: {
        // Header
        appTitle: 'LUCKY DRAW',
        
        // Prize levels
        prizeSpecial: 'GRAND PRIZE',
        prizeFirst: 'FIRST PRIZE',
        prizeSecond: 'SECOND PRIZE',
        prizeThird: 'THIRD PRIZE',
        prizeConsolation: 'CONSOLATION PRIZE',
        
        // Display area
        instruction: 'Press Draw button to start',
        
        // Buttons
        btnDraw: 'DRAW',
        btnDrawing: 'DRAWING...',
        btnLoad: 'Load List',
        btnRegister: 'REGISTER',
        
        // Winners section
        winnersTitle: 'Winners List',
        winnerNumber: 'Code',
        winnerName: 'Name',
        winnerPrize: 'Prize',
        
        // Participants section
        participantsTitle: 'Manage Participants',
        participantsPlaceholder: `Enter participant list (one per line):
Code - Name

Example:
VNPT000001 - John Doe
CTV000001 - Jane Smith
VNPT000002 - Mike Johnson
...

Or just codes:
VNPT000001
CTV000001
VNPT000002`,
        totalParticipants: 'Total participants:',
        remainingParticipants: 'Remaining:',
        
        // Alerts
        alertNoInput: 'Please enter the participant list!',
        alertInvalidList: 'Invalid list!',
        alertLoadSuccess: 'Successfully loaded {count} participants!',
        alertNoRemaining: 'No participants remaining! Please reload the list.',
        
        // Congratulations popup
        congratulations: 'CONGRATULATIONS!',
        winnerPosition: 'Winner',
        totalWinners: 'Total Winners',
        people: 'people',
        winnerCode: 'Code:',
        winnerNameLabel: 'Name:',
        prizeLabel: 'Prize:',
        btnClose: 'Close',
        
        // Footer
        footerText: 'Â© 2026 Lucky Draw. All rights reserved.',
        
        // Default participant name
        defaultParticipant: 'Participant',
        
        // Prize names (lowercase for data)
        prizeSpecialData: 'grand prize',
        prizeFirstData: 'first prize',
        prizeSecondData: 'second prize',
        prizeThirdData: 'third prize',
        prizeConsolationData: 'consolation prize',
        
        // Settings section
        settingsTitle: 'System Configuration',
        timingSettings: 'Timing Settings',
        prizeSettings: 'Prize Rewards List',
        prizeCountSettings: 'Winner Count',
        spinDuration: 'Spin duration (seconds):',
        digitDelay: 'Digit display delay (seconds):',
        spinDurationHint: 'Wait time before showing result',
        digitDelayHint: 'Time interval between each result digit',
        countSpecialLabel: 'Grand Prize:',
        countFirstLabel: 'First Prize:',
        countSecondLabel: 'Second Prize:',
        countThirdLabel: 'Third Prize:',
        countConsolationLabel: 'Consolation Prize:',
        countHint: 'Number of winners',
        prizeSpecialLabel: 'Grand Prize:',
        prizeFirstLabel: 'First Prize:',
        prizeSecondLabel: 'Second Prize:',
        prizeThirdLabel: 'Third Prize:',
        prizeConsolationLabel: 'Consolation Prize:',
        prizePlaceholder: 'Enter prize name',
        btnSaveSettings: 'Save Settings',
        btnResetSettings: 'Reset to Default',
        alertSettingsSaved: 'Settings saved successfully!',
        alertSettingsReset: 'Settings reset to default!',
        
        // Background customization
        bgCustomization: 'Background Customization',
        bgCustomLabel: 'Custom Background:',
        btnUploadBg: 'ðŸ“ Upload Background',
        bgHint: 'Upload your custom background image (JPG, PNG)',
        btnResetBg: 'ðŸ”„ Reset to Default',
        bgNoCustom: 'No custom background',
        bgCurrentBg: 'Current Background',
        bgUploadSuccess: 'âœ… Background uploaded!',
        bgResetSuccess: 'âœ… Reset to default'
    }
};

// Language Manager
class LanguageManager {
    constructor() {
        this.currentLanguage = localStorage.getItem('luckydraw_language') || 'en';
        this.translations = translations;
    }
    
    setLanguage(lang) {
        if (!this.translations[lang]) {
            console.error(`Language ${lang} not found`);
            return;
        }
        
        this.currentLanguage = lang;
        localStorage.setItem('luckydraw_language', lang);
        this.updatePageContent();
    }
    
    t(key) {
        return this.translations[this.currentLanguage][key] || key;
    }
    
    updatePageContent() {
        // Update header
        const appTitle = document.querySelector('.logo h1');
        if (appTitle) appTitle.textContent = this.t('appTitle');
        
        // Update prize buttons - only update if they match default prize names
        const prizeBtns = document.querySelectorAll('.prize-btn');
        const defaultPrizeNames = ['giáº£i Ä‘áº·c biá»‡t', 'giáº£i nháº¥t', 'giáº£i nhÃ¬', 'giáº£i ba', 'giáº£i khuyáº¿n khÃ­ch'];
        const prizeKeys = ['prizeSpecial', 'prizeFirst', 'prizeSecond', 'prizeThird', 'prizeConsolation'];
        
        prizeBtns.forEach((btn) => {
            const prizeName = btn.dataset.prize;
            const prizeIndex = defaultPrizeNames.indexOf(prizeName);
            
            // Only update if this is a default prize, leave custom prizes alone
            if (prizeIndex >= 0) {
                const span = btn.querySelector('span:last-child');
                if (span) span.textContent = this.t(prizeKeys[prizeIndex]);
            }
        });
        
        // Update current prize display
        const currentPrizeDisplay = document.querySelector('.current-prize');
        if (currentPrizeDisplay && window.luckyDraw) {
            const prizeIndex = defaultPrizeNames.indexOf(window.luckyDraw.currentPrize);
            if (prizeIndex >= 0) {
                currentPrizeDisplay.textContent = this.t(prizeKeys[prizeIndex]);
            } else {
                // For custom prizes, just display the name in uppercase
                currentPrizeDisplay.textContent = window.luckyDraw.currentPrize.toUpperCase();
            }
        }
        
        // Update instruction
        const instruction = document.querySelector('.instruction');
        if (instruction) instruction.textContent = this.t('instruction');
        
        // Update draw button
        const drawBtn = document.querySelector('.btn-draw span');
        if (drawBtn && !window.luckyDraw?.isSpinning) {
            drawBtn.textContent = this.t('btnDraw');
        }
        
        // Update winners section
        const winnersTitle = document.querySelector('.winners-section h3');
        if (winnersTitle) winnersTitle.textContent = this.t('winnersTitle');
        
        // Update participants section
        const participantsTitle = document.querySelector('.participants-section h2');
        if (participantsTitle) participantsTitle.textContent = this.t('participantsTitle');
        
        const participantsInput = document.getElementById('participants-input');
        if (participantsInput) participantsInput.placeholder = this.t('participantsPlaceholder');
        
        const loadBtn = document.getElementById('load-participants');
        if (loadBtn) loadBtn.textContent = this.t('btnLoad');
        
        // Update participants info labels
        const totalLabel = document.querySelector('.participants-info p:first-child');
        if (totalLabel) {
            const count = document.getElementById('total-participants').textContent;
            totalLabel.innerHTML = `${this.t('totalParticipants')} <strong id="total-participants">${count}</strong>`;
        }
        
        const remainingLabel = document.querySelector('.participants-info p:last-child');
        if (remainingLabel) {
            const count = document.getElementById('remaining-participants').textContent;
            remainingLabel.innerHTML = `${this.t('remainingParticipants')} <strong id="remaining-participants">${count}</strong>`;
        }
        
        // Update footer
        const footer = document.querySelector('footer p');
        if (footer) footer.textContent = this.t('footerText');
        
        // Update settings section
        const settingsTitle = document.querySelector('.settings-section h2');
        if (settingsTitle) settingsTitle.textContent = this.t('settingsTitle');
        
        // Find timing settings group (first one without prize-settings-dynamic class)
        const timingGroup = document.querySelector('.settings-section .settings-group:not(.prize-settings-dynamic)');
        if (timingGroup) {
            const timingTitle = timingGroup.querySelector('h3');
            if (timingTitle && !timingTitle.textContent.includes('Background')) {
                timingTitle.textContent = 'â±ï¸ ' + this.t('timingSettings');
            }
        }
        
        // Update settings labels
        const spinDurationLabel = document.querySelector('label[for="spin-duration"]');
        if (spinDurationLabel) spinDurationLabel.textContent = this.t('spinDuration');
        
        const digitDelayLabel = document.querySelector('label[for="digit-delay"]');
        if (digitDelayLabel) digitDelayLabel.textContent = this.t('digitDelay');
        
        // Update hints with safer navigation
        const spinDurationInput = document.getElementById('spin-duration');
        if (spinDurationInput) {
            const hint = spinDurationInput.nextElementSibling;
            if (hint && hint.classList.contains('setting-hint')) {
                hint.textContent = this.t('spinDurationHint');
            }
        }
        
        const digitDelayInput = document.getElementById('digit-delay');
        if (digitDelayInput) {
            const hint = digitDelayInput.nextElementSibling;
            if (hint && hint.classList.contains('setting-hint')) {
                hint.textContent = this.t('digitDelayHint');
            }
        }
        
        // Update settings buttons
        const saveBtn = document.getElementById('save-settings');
        if (saveBtn) saveBtn.innerHTML = 'ðŸ’¾ ' + this.t('btnSaveSettings');
        
        const resetBtn = document.getElementById('reset-settings');
        if (resetBtn) resetBtn.innerHTML = 'ðŸ”„ ' + this.t('btnResetSettings');
        
        // Update background customization section
        const bgTitle = document.querySelector('.settings-section .settings-group:nth-child(4) h3');
        if (bgTitle) bgTitle.textContent = 'ðŸŽ¨ ' + this.t('bgCustomization');
        
        const bgLabel = document.querySelector('label[for="background-upload"]');
        if (bgLabel) bgLabel.textContent = this.t('bgCustomLabel');
        
        const uploadBgBtn = document.getElementById('btn-upload-bg');
        if (uploadBgBtn) uploadBgBtn.textContent = this.t('btnUploadBg');
        
        const bgHint = document.querySelector('.background-upload .setting-hint');
        if (bgHint) bgHint.textContent = this.t('bgHint');
        
        const resetBgBtn = document.getElementById('btn-reset-bg');
        if (resetBgBtn) resetBgBtn.textContent = this.t('btnResetBg');
        
        // Update background preview text if no custom background
        const bgPreview = document.getElementById('background-preview');
        if (bgPreview && bgPreview.querySelector('.preview-text') && !localStorage.getItem('luckydraw_custom_background')) {
            bgPreview.querySelector('.preview-text').textContent = this.t('bgNoCustom');
        }
        if (bgPreview && bgPreview.querySelector('.preview-overlay')) {
            bgPreview.querySelector('.preview-overlay').textContent = this.t('bgCurrentBg');
        }
        
        // Update language selector active state
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.lang === this.currentLanguage);
        });
        
        // Re-translate winners list
        if (window.luckyDraw && window.luckyDraw.winners.length > 0) {
            window.luckyDraw.updateWinnersList();
        }
    }
    
    getPrizeTranslation(prizeData) {
        const prizeMap = {
            'giáº£i Ä‘áº·c biá»‡t': 'prizeSpecial',
            'giáº£i nháº¥t': 'prizeFirst',
            'giáº£i nhÃ¬': 'prizeSecond',
            'giáº£i ba': 'prizeThird',
            'giáº£i khuyáº¿n khÃ­ch': 'prizeConsolation',
            'grand prize': 'prizeSpecial',
            'first prize': 'prizeFirst',
            'second prize': 'prizeSecond',
            'third prize': 'prizeThird',
            'consolation prize': 'prizeConsolation'
        };
        
        const key = prizeMap[prizeData.toLowerCase()];
        return key ? this.t(key) : prizeData;
    }
}

// Initialize language manager
const languageManager = new LanguageManager();
